<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription au Grand Jeu Immersif</title>
</head>
</script>
<script type="module">
    function testClick() {
        alert("üöÄ Le bouton fonctionne !");
    }</script>
<body>
    <h1>Inscription au Grand Jeu Immersif √† √âpinac</h1>

    <form id="registration-form">
        <label for="team-name">Nom de l'√©quipe :</label>
        <input type="text" id="team-name" name="team_name" required><br><br>

        <label for="phone-number">Num√©ro de t√©l√©phone :</label>
        <input type="tel" id="phone-number" name="phone_number" pattern="^(\+33|0)[1-9]\d{8}$" required placeholder="Ex : 0612345678"><br><br>
        <p style="color: red;"><strong>‚ö† Le num√©ro de t√©l√©phone est obligatoire pour recevoir les questions du jeu.</strong></p>

        <label for="participants">Nombre de participants :</label>
        <input type="number" id="participants" name="participants" min="1" required><br><br>

        <!-- BOUTON UNIQUE : INSCRIPTION + PAIEMENT PAYPAL -->
        <button type="button" onclick="testClick">S'inscrire et payer avec PayPal</button>
    </form>

    <script type="module">
        
            const token = import.meta.env.VITE_TELEGRAM_BOT_TOKEN;
	    const chatId = import.meta.env.VITE_TELEGRAM_CHAT_ID;

	function sendTelegramMessage() {
            let teamName = document.getElementById("team-name").value;
            let phoneNumber = document.getElementById("phone-number").value;
            let participants = document.getElementById("participants").value;

            let message = "üìå **Nouvelle Inscription !**\n\n"
                + "üë• **√âquipe** : " + teamName + "\n"
                + "üìû **T√©l√©phone** : " + phoneNumber + "\n"
                + "üéüÔ∏è **Participants** : " + participants + "\n\n"
                + "‚úÖ Merci pour votre inscription ! Vous recevrez bient√¥t votre premi√®re question.";

            let url = 'https://api.telegram.org/bot${token}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(message)}&parse_mode=Markdown';

            return fetch(url)
                .then(response => {
		    if (response.ok) {
                    console.log("Message Telegram envoy√©");
                return true;
	    } else {
                    console.error("Erreur lors de l'envoi du message Telegram");
		return false;
        }
})
		.catch(error => {
		    console.error("Erreur Telegram :", error);
		return false;
	});
}

        function redirectToPayPal(event) {
            event.preventDefault();

            sendTelegramMessage().then(success => {
	    if (success) {
                let participants = document.getElementById("participants").value;
                let totalPrice = 5 * participants; // Calcule le montant total
                let paypalLink = 'https://paypal.me/LaurieBlanot?country.x=FR&locale.x=fr_FR/${totalPrice}';

                alert('‚úÖ Inscription valid√©e ! Montant √† payer : ${totalPrice} ‚Ç¨');
                window.open(paypalLink, "_blank");  // Ouvrir PayPal
	    } else {
		alert("X Erreur : L'inscription n'a pas √©t√© envoy√©e √† Telegram.");
           }
	 });
        }
    </script>
</body>
</html>