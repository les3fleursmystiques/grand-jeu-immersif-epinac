<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription au Grand Jeu Immersif</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="header">
        <img src="images/logo-myssea.png" alt="Logo Myssea">
    </div>

    <h1>Inscription au Grand Jeu Immersif Ã  Ã‰pinac</h1>

    <div id="telegram-warning">
        <strong>âš  IMPORTANT :</strong>
        <p>Vous devez avoir un <strong>pseudo Telegram</strong> et avoir contactÃ© notre bot.</p>
        <p>ðŸ“² <a href="https://telegram.org" target="_blank">TÃ©lÃ©chargez Telegram</a></p>
        <p>ðŸ’¬ Avant de vous inscrire, envoyez <strong>/start</strong> Ã  :
            <a href="https://t.me/MysseaEpinac_bot" target="_blank">@mysseatest_bot</a></p>
        <p>ðŸ”¹ <a href="https://www.googe.com/search?q=crÃ©er+un+pseudo+Telegram" target="_blank">Comment crÃ©er un pseudo Telegram ?</a></p>
    </div>

    <form id="registration-form">
        <label for="team-name">Nom de l'Ã©quipe :</label>
        <input type="text" id="team-name" name="team_name" required><br><br>

        <label for="telegram-username">Nom d'utilisateur Telegram :</label>
        <input type="text" id="telegram-username" name="telegram_username" required placeholder="Ex: @monpseudo"><br><br>
        <p style="color: red;"><strong>âš  Entrez correctement votre identifiant Telegram (ex: @votrePseudo)</strong></p>

        <label for="participants">Nombre de participants :</label>
        <input type="number" id="participants" name="participants" min="1" required><br><br>

        <label for="promo-code">Code promo (facultatif) :</label>
        <input type="text" id="promo-code" name="promo_code" placeholder="Ex: MYS-2J-Q5W7"><br><br>

        <p id="promo-warning" style="color: red; display: none;"></p>

        <button type="button" id="pay-btn" disabled style="background-color: grey; cursor: not-allowed;">
            â›” Inscription temporairement fermÃ©e â›”
        </button>
    </form>

    <script>
        const validPromoCodes = {
            "MYSSEPA1": 1,
            "MYSSEPA2": 2,
            "MYSSEPRO": 5,
            "MYSSEADMINITY": Infinity
        };

        const paypalLink = "https://paypal.me/LaurieBlanot?country.x=FR&locale.x=fr_FR"; // Remplace par ton lien PayPal

        document.addEventListener("DOMContentLoaded", function () {
            const telegramInput = document.getElementById("telegram-username");
            const teamInput = document.getElementById("team-name");
            const participantsInput = document.getElementById("participants");
            const promoInput = document.getElementById("promo-code");
            const payBtn = document.getElementById("pay-btn");
            const warningText = document.getElementById("promo-warning");

            telegramInput.addEventListener("blur", function () {
                if (!telegramInput.value.startsWith("@")) {
                    telegramInput.value = "@" + telegramInput.value;
                }
            });

            document.getElementById("registration-form").addEventListener("input", function () {
                const username = telegramInput.value.trim();
                const team = teamInput.value.trim();
                const count = parseInt(participantsInput.value) || 0;
                const code = promoInput.value.trim().toUpperCase();

                const isFilled = username && team && count > 0;

                if (!isFilled) {
                    disablePayBtn("â›” Inscription temporairement fermÃ©e â›”");
                    return;
                }

                if (code in validPromoCodes) {
                    const maxAllowed = validPromoCodes[code];
                    if (count <= maxAllowed) {
                        warningText.style.display = "none";
                        enablePayBtn("âœ… Code promo acceptÃ© â€” inscription gratuite", null);
                    } else {
                        const message = `âš  Le code "${code}" est limitÃ© Ã  ${maxAllowed} participant(s). Veuillez rÃ©gler la diffÃ©rence.`;
                        warningText.innerText = message;
                        warningText.style.display = "block";
                        enablePayBtn("âž¡ Payer la diffÃ©rence sur PayPal", paypalLink);
                    }
                } else if (code === "") {
                    warningText.style.display = "none";
                    enablePayBtn("âž¡ Payer sur PayPal", paypalLink);
                } else {
                    warningText.innerText = `âš  Code promo non reconnu.`;
                    warningText.style.display = "block";
                    disablePayBtn("â›” Inscription temporairement fermÃ©e â›”");
                }
            });

            function disablePayBtn(label) {
                payBtn.innerText = label;
                payBtn.disabled = true;
                payBtn.style.backgroundColor = "grey";
                payBtn.style.cursor = "not-allowed";
                payBtn.onclick = null;
            }

            function enablePayBtn(label, link) {
                payBtn.innerText = label;
                payBtn.disabled = false;
                payBtn.style.backgroundColor = "#4CAF50";
                payBtn.style.cursor = "pointer";
                payBtn.onclick = function () {
                    if (link) window.open(link, "_blank");
                    else alert("Inscription validÃ©e avec votre code promo !");
                };
            }
        });
    </script>
</body>
</html>
