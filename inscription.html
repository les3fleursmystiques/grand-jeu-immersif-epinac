<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inscription au Grand Jeu Immersif</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="header">
    <img src="images/logo-myssea.png" alt="Logo Myssea">
  </div>

  <h1>Inscription au Grand Jeu Immersif Ã  Ã‰pinac</h1>

  <div id="telegram-warning">
    <strong>âš  IMPORTANT :</strong>
    <p>Vous devez avoir un <strong>pseudo Telegram</strong> et avoir contactÃ© notre bot.</p>
    <p>ðŸ“² <a href="https://telegram.org" target="_blank">TÃ©lÃ©chargez Telegram</a></p>
    <p>ðŸ”¹ <a href="https://www.google.com/search?q=crÃ©er+un+pseudo+Telegram" target="_blank">Comment crÃ©er un pseudo Telegram ?</a></p>
  </div>

  <form id="registration-form">
    <label for="team-name">Nom de l'Ã©quipe :</label>
    <input type="text" id="team-name" name="team_name" required><br><br>

    <label for="telegram-username">Nom d'utilisateur Telegram :</label>
    <input type="text" id="telegram-username" name="telegram_username" required placeholder="Ex: @monpseudo"><br><br>
    <p style="color: red;"><strong>âš  Entrez correctement votre identifiant Telegram (ex: @votrePseudo)</strong></p>

    <label for="participants">Nombre de participants :</label>
    <select id="participants" name="participants" required>
      <option value="">-- SÃ©lectionnez --</option>
      <option value="1">1 joueur</option>
      <option value="2">2 joueurs</option>
      <option value="3">3 joueurs</option>
      <option value="4">4 joueurs</option>
      <option value="5">5 joueurs</option>
    </select><br><br>

    <!-- Code promo discret -->
    <input type="text" id="promo-code" name="promo_code" placeholder="Code promo (facultatif)" style="display: none;"><br>

    <p id="promo-warning" style="color: red; display: none;"></p>

    <div id="payment-section" style="display: none;">
      <p><strong>Tarif :</strong> <span id="tarif-text"></span></p>
      <button type="button" id="payment-btn" class="btn">âž¡ Payer par carte bancaire</button>
    </div>
  </form>

  <script>
    const validPromoCodes = {
      "MYSSEPA1": 1,
      "MYSSEPA2": 2,
      "MYSSEPRO": 5,
      "MYSSEADMINITY": Infinity
    };

    const stripeLinks = {
      1: "https://buy.stripe.com/test_eVa29Ag6I69S3oAbII",
      2: "https://buy.stripe.com/test_9AQ5lM1bO69S2kw289",
      3: "https://buy.stripe.com/test_bIY4hIg6IbucbV64gi",
      4: "https://buy.stripe.com/test_28oeWm4o09m42kwbIL",
      5: "https://buy.stripe.com/test_7sI3dEg6I41K6AM9AE"
    };

    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("registration-form");
      const participants = document.getElementById("participants");
      const promoInput = document.getElementById("promo-code");
      const warning = document.getElementById("promo-warning");
      const tarifText = document.getElementById("tarif-text");
      const paymentBtn = document.getElementById("payment-btn");
      const paymentSection = document.getElementById("payment-section");

      // Active champ promo cachÃ© avec raccourci clavier (ex: shift + P)
      document.addEventListener("keydown", function (e) {
        if (e.shiftKey && e.key === "P") {
          promoInput.style.display = "block";
          promoInput.focus();
        }
      });

      form.addEventListener("input", () => {
        const count = parseInt(participants.value);
        const promo = promoInput.value.trim().toUpperCase();
        warning.style.display = "none";

        if (!count) {
          paymentSection.style.display = "none";
          return;
        }

        if (promo && promo in validPromoCodes) {
          const maxAllowed = validPromoCodes[promo];
          if (count <= maxAllowed) {
            tarifText.textContent = "AccÃ¨s gratuit avec code promo";
            paymentBtn.innerText = "âœ… Valider et accÃ©der au jeu";
            paymentBtn.onclick = () => {
              alert("Inscription validÃ©e avec code promo !");
              window.location.href = "acces-reel.html";
            };
            paymentSection.style.display = "block";
          } else {
            warning.innerText = `âš  Code promo limitÃ© Ã  ${maxAllowed} joueur(s).`;
            warning.style.display = "block";
            paymentSection.style.display = "none";
          }
        } else if (promo && !(promo in validPromoCodes)) {
          warning.innerText = "âš  Code promo non reconnu.";
          warning.style.display = "block";
          paymentSection.style.display = "none";
        } else {
          tarifText.textContent = stripeLinks[count] ? `${count * 5} â‚¬` : "";
          paymentBtn.innerText = "âž¡ Payer par carte bancaire";
          paymentBtn.onclick = () => {
            window.location.href = stripeLinks[count];
          };
          paymentSection.style.display = "block";
        }
      });
    });
  </script>
</body>
</html>